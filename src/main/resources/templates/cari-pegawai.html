<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="ISO-8859-1">
	<title>Cari Pegawai</title>
	
	<object th:include="fragments/fragment :: css" th:remove="tag"></object>
	<object th:include="fragments/fragment :: js" th:remove="tag"></object>
</head>

<body>
	<nav th:replace="fragments/fragment :: navbar"></nav>

<div class="container">
<br>
	<div class="row justify-content-center">
		<div class="col-md-12">
			<div class="card">
				<div class="card-header">
					<h3 align="center">Cari Pegawai</h3>
				</div>
				<form th:action="@{/pegawai/cari}" method="GET">
					<div class="card-body">
						<table class="table table-striped table-bordered" style="width:100%">
							<tr>
								<td>Provinsi</td>
								<td>
									<select class="form-control" required name="provinsi" id="provinsi" th:value="${listProvinsi}">
										<option>Pilih Provinsi</option>
										<option th:each="provinsi : ${listProvinsi}" th:value="${provinsi.id}" th:text="${provinsi.nama}"></option>
									</select>
								</td>
							</tr>
							<tr>
								<td>Nama Instansi</td>
								<td>
									<select class="form-control" name="instansi" id="instansi">
										<option disabled selected>Pilih Instansi</option>
										<option th:each="instansi : ${listInstansi}" th:value="${instansi.id}" th:text="${instansi.nama}+' - '+${instansi.provinsi.nama}"></option>
									</select>
								</td>
							</tr>
							<tr>
								<td>Jabatan</td>
								<td>
									<select class="form-control" name="jabatan" id="jabatan">
										<option disabled selected>Pilih Jabatan</option>
										<option th:each="jabatan : ${listJabatan}" th:value="${jabatan.id}" th:text="${jabatan.nama}"></option>
									</select>
								</td>
							</tr>
						</table>
						<button type="submit" class="btn btn-primary">Lihat</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	<br>
	<div class="row">
		<div class="col-md-12">
			<div class="card">
					<div class="card-body">
						<table id="hasilPegawai" class="table table-striped table-bordered" style="width:100%">
							<thead>
		                        <tr>
		                            <th>NIP</th>
		                            <th>Nama</th>
		                            <th>Tempat Lahir</th>
		                            <th>Tanggal Lahir</th>
		                            <th>Tahun Masuk</th>
		                            <th>Nama Instansi</th>
		                            <th>Jabatan</th>
		                        </tr>
                        	</thead>
                        <tbody>
                            <tr th:each="pegawai : ${listPegawai}">
                                <td th:text="${pegawai.nip}"></td>
                                <td th:text="${pegawai.nama}"></td>
                                <td th:text="${pegawai.tempat_lahir}"></td>
                                <td th:text="${pegawai.tanggal_lahir}"></td>
                                <td th:text="${pegawai.tahun_masuk}"></td>
                                <td th:text="${hasilInstansi.nama}"></td>
                                <td th:text="${hasilJabatan.nama}"></td>
                            </tr>
                        </tbody>
						</table>
				</div>
			</div>
		</div>
	</div>
</div>
<br>

<script>
    $(document).ready(function() {
        $('#hasilPegawai').DataTable();
    } );
    $('#provinsi').change(
        function() {
            $.getJSON("/provinsi/instansi", {
                id : $(this).val(),
                ajax : 'true'
            }, function(data) {
                var html = '<option value="">Pilih Instansi</option>';
                var len = data.length;
                for ( var i = 0; i < len; i++) {
                    html += '<option value="' +data[i].id + '">'
                        + data[i].nama + '</option>';
                }
                html += '</option>';
                $('#instansi').html(html);
            });
        });
</script>

</body>

</html>